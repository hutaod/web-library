<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mobx ä½¿ç”¨æ€»ç»“ | æ—¶ç¾½Â·å‰ç«¯çŸ¥è¯†åº“</title>
    <meta name="description" content="å‰ç«¯,å‰ç«¯å·¥ç¨‹å¸ˆ,å‰ç«¯è‡ªå­¦,å‰ç«¯è¿›é˜¶,å‰ç«¯å‘å±•">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.82c487b9.css" as="style"><link rel="preload" href="/assets/js/app.5e1dc976.js" as="script"><link rel="preload" href="/assets/js/2.654fa9b9.js" as="script"><link rel="preload" href="/assets/js/6.c776911c.js" as="script"><link rel="prefetch" href="/assets/js/10.db9dd162.js"><link rel="prefetch" href="/assets/js/11.541d9850.js"><link rel="prefetch" href="/assets/js/12.ef8e0289.js"><link rel="prefetch" href="/assets/js/13.92ccc43f.js"><link rel="prefetch" href="/assets/js/14.ec3c53ba.js"><link rel="prefetch" href="/assets/js/15.0dc7c2d6.js"><link rel="prefetch" href="/assets/js/16.13f647c2.js"><link rel="prefetch" href="/assets/js/17.d92c65dc.js"><link rel="prefetch" href="/assets/js/18.fd317fd4.js"><link rel="prefetch" href="/assets/js/19.cafa0f78.js"><link rel="prefetch" href="/assets/js/20.e718caca.js"><link rel="prefetch" href="/assets/js/21.d18a0b10.js"><link rel="prefetch" href="/assets/js/22.4bd61e16.js"><link rel="prefetch" href="/assets/js/23.342b190f.js"><link rel="prefetch" href="/assets/js/24.42563896.js"><link rel="prefetch" href="/assets/js/25.d1702b91.js"><link rel="prefetch" href="/assets/js/26.b5410708.js"><link rel="prefetch" href="/assets/js/27.b55f6f90.js"><link rel="prefetch" href="/assets/js/28.509d6c21.js"><link rel="prefetch" href="/assets/js/29.402fa13a.js"><link rel="prefetch" href="/assets/js/3.e19b672f.js"><link rel="prefetch" href="/assets/js/30.02277e72.js"><link rel="prefetch" href="/assets/js/31.932846f5.js"><link rel="prefetch" href="/assets/js/32.cc49be50.js"><link rel="prefetch" href="/assets/js/33.d1ff494d.js"><link rel="prefetch" href="/assets/js/34.2707ece9.js"><link rel="prefetch" href="/assets/js/35.f8c76f52.js"><link rel="prefetch" href="/assets/js/36.aef0f32e.js"><link rel="prefetch" href="/assets/js/37.1a9c5908.js"><link rel="prefetch" href="/assets/js/38.903136ce.js"><link rel="prefetch" href="/assets/js/39.36933768.js"><link rel="prefetch" href="/assets/js/4.e6adf6e6.js"><link rel="prefetch" href="/assets/js/40.596b11f9.js"><link rel="prefetch" href="/assets/js/41.49536e3a.js"><link rel="prefetch" href="/assets/js/42.85828572.js"><link rel="prefetch" href="/assets/js/43.34983cb7.js"><link rel="prefetch" href="/assets/js/44.7714ead4.js"><link rel="prefetch" href="/assets/js/45.abc50b11.js"><link rel="prefetch" href="/assets/js/46.0ea41615.js"><link rel="prefetch" href="/assets/js/47.e44eb3d6.js"><link rel="prefetch" href="/assets/js/48.aabe22c0.js"><link rel="prefetch" href="/assets/js/49.baff539a.js"><link rel="prefetch" href="/assets/js/5.1ed6628b.js"><link rel="prefetch" href="/assets/js/50.4d4f8933.js"><link rel="prefetch" href="/assets/js/51.294b130c.js"><link rel="prefetch" href="/assets/js/52.d3533b10.js"><link rel="prefetch" href="/assets/js/53.adc603a3.js"><link rel="prefetch" href="/assets/js/7.cce5be5e.js"><link rel="prefetch" href="/assets/js/8.897110a3.js"><link rel="prefetch" href="/assets/js/9.55f9e5df.js">
    <link rel="stylesheet" href="/assets/css/0.styles.82c487b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">æ—¶ç¾½Â·å‰ç«¯çŸ¥è¯†åº“</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  åšå®¢
</a></div><div class="nav-item"><a href="/AlgorithmAndDataStructure/" class="nav-link">
  æ•°æ®ç»“æ„ä¸ç®—æ³•
</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">
  å‰ç«¯
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  Nodejs
</a></div><div class="nav-item"><a href="/extends/" class="nav-link">
  æ‰©å±•
</a></div><div class="nav-item"><a href="https://github.com/ht1131589588/web-library" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  åšå®¢
</a></div><div class="nav-item"><a href="/AlgorithmAndDataStructure/" class="nav-link">
  æ•°æ®ç»“æ„ä¸ç®—æ³•
</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">
  å‰ç«¯
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  Nodejs
</a></div><div class="nav-item"><a href="/extends/" class="nav-link">
  æ‰©å±•
</a></div><div class="nav-item"><a href="https://github.com/ht1131589588/web-library" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Reactç³»åˆ—</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front/React/Reactä½¿ç”¨æ€»ç»“.html" class="sidebar-link">Reactä½¿ç”¨æ€»ç»“</a></li><li><a href="/front/React/Reduxæºç æ¢ç´¢.html" class="sidebar-link">Redux æºç æ¢ç´¢</a></li><li><a href="/front/React/Reactæºç æ¢ç´¢.html" class="sidebar-link">React æºç è§£è¯»</a></li><li><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html" class="active sidebar-link">Mobx ä½¿ç”¨æ€»ç»“</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html#å‰è¨€" class="sidebar-link">å‰è¨€</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html#çŠ¶æ€ç®¡ç†" class="sidebar-link">çŠ¶æ€ç®¡ç†</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html#redux-vs-mobx" class="sidebar-link">Redux Vs Mobx</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html#å…ˆç®€å•ä»‹ç»ä¸€ä¸‹-redux" class="sidebar-link">å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ Redux</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html#æ¥ä¸‹æ¥å›åˆ°ä¸»é¢˜-mobx" class="sidebar-link">æ¥ä¸‹æ¥å›åˆ°ä¸»é¢˜ -- Mobx</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html#redux-å’Œ-mobx-çš„å¯¹æ¯”" class="sidebar-link">Redux å’Œ Mobx çš„å¯¹æ¯”</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html#ç»“è¯­" class="sidebar-link">ç»“è¯­</a></li><li class="sidebar-sub-header"><a href="/front/React/Mobxä½¿ç”¨æ€»ç»“.html#å‚è€ƒ" class="sidebar-link">å‚è€ƒ</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mobx-ä½¿ç”¨æ€»ç»“"><a href="#mobx-ä½¿ç”¨æ€»ç»“" aria-hidden="true" class="header-anchor">#</a> Mobx ä½¿ç”¨æ€»ç»“</h1> <p>æœ¬æ–‡ä¸»è¦ä»‹ç» Mobx çš„ä¸€äº›å¸¸è§ç”¨æ³•å’Œç†å¿µï¼Œä»¥åŠä¸€äº›ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Œè¿˜ä¼šå¯¹æ¯” Redux å’Œ Mobx å„è‡ªçš„ä¼˜åŠ¿ï¼Œæœ¬ç¯‡æ–‡ç« ä¸ä¼šè¿‡å¤šçš„è®²è§£ Redux æˆ‘ Mobx çš„æºç ï¼Œåœ¨æ–‡ç« ç»“å°¾å¤„æœ‰å‡ ç¯‡å¯¹ Redux å’Œ Mobx æºç çš„åˆ†æçš„æ–‡ç« ï¼Œæœ‰æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»çœ‹ä¸€ä¸‹</p> <h2 id="å‰è¨€"><a href="#å‰è¨€" aria-hidden="true" class="header-anchor">#</a> å‰è¨€</h2> <p>å¦‚æœä½ å¯¹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Redux æˆ–è€… Mobx æœ‰ç–‘æƒ‘çš„è¯ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™æ®µè§£é‡Šï¼š</p> <p>å½“æˆ‘ä»¬ä½¿ç”¨ React å¼€å‘ web åº”ç”¨ç¨‹åºæ—¶ï¼Œåœ¨ React ç»„ä»¶å†…ï¼Œå¯ä»¥ä½¿ç”¨ this.setState()å’Œ this.state å¤„ç†æˆ–è®¿é—®ç»„ä»¶å†…çŠ¶æ€ï¼Œä½†æ˜¯éšç€é¡¹ç›®å˜å¤§ï¼ŒçŠ¶æ€å˜å¤æ‚ï¼Œé€šå¸¸éœ€è¦è€ƒè™‘ç»„ä»¶é—´é€šä¿¡é—®é¢˜ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p> <ol><li>æŸä¸€ä¸ªçŠ¶æ€éœ€è¦åœ¨å¤šä¸ªç»„ä»¶é—´å…±äº«ï¼ˆè®¿é—®ï¼Œæ›´æ–°ï¼‰ï¼›</li> <li>æŸç»„ä»¶å†…äº¤äº’éœ€è¦è§¦å‘å…¶ä»–ç»„ä»¶çš„çŠ¶æ€æ›´æ–°ï¼›</li></ol> <p>å…³äºè¿™äº›é—®é¢˜ï¼ŒReact ç»„ä»¶å¼€å‘å®è·µæ¨èå°†å…¬ç”¨ç»„ä»¶çŠ¶æ€æå‡ï¼š</p> <p>é€šå¸¸å¤šç»„ä»¶éœ€è¦å¤„ç†åŒä¸€çŠ¶æ€ï¼Œæˆ‘ä»¬æ¨èå°†å…±äº«çŠ¶æ€æå‡è‡³ä»–ä»¬çš„å…±åŒæœ€è¿‘ç¥–å…ˆç»„ä»¶å†…ã€‚</p> <p>å½“é¡¹ç›®è¶Šå‘å¤æ‚æ—¶ï¼Œæˆ‘ä»¬å‘ç°ä»…ä»…æ˜¯æå‡çŠ¶æ€å·²ç»æ— æ³•é€‚åº”å¦‚æ­¤å¤æ‚çš„çŠ¶æ€ç®¡ç†äº†ï¼Œç¨‹åºçŠ¶æ€å˜å¾—æ¯”è¾ƒéš¾åŒæ­¥ï¼Œæ“ä½œï¼Œåˆ°å¤„æ˜¯å›è°ƒï¼Œå‘å¸ƒï¼Œè®¢é˜…ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ›´å¥½çš„çŠ¶æ€ç®¡ç†æ–¹å¼ï¼Œäºæ˜¯å°±å¼•å…¥äº†çŠ¶æ€ç®¡ç†åº“ï¼Œå¦‚<code>Redux</code>ï¼Œ<code>Mobx</code>ç­‰ã€‚</p> <h2 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" aria-hidden="true" class="header-anchor">#</a> çŠ¶æ€ç®¡ç†</h2> <p>çŠ¶æ€ç®¡ç†åº“ï¼Œæ— è®ºæ˜¯ Reduxï¼Œè¿˜æ˜¯ Mobx è¿™äº›ï¼Œå…¶æœ¬è´¨éƒ½æ˜¯ä¸ºäº†è§£å†³çŠ¶æ€ç®¡ç†æ··ä¹±ï¼Œæ— æ³•æœ‰æ•ˆåŒæ­¥çš„é—®é¢˜ï¼Œå®ƒä»¬éƒ½æ”¯æŒï¼š</p> <ol><li>ç»Ÿä¸€ç»´æŠ¤ç®¡ç†åº”ç”¨çŠ¶æ€ï¼›</li> <li>æŸä¸€çŠ¶æ€åªæœ‰ä¸€ä¸ªå¯ä¿¡æ•°æ®æ¥æºï¼Œé€šå¸¸å‘½åä¸º storeï¼ŒæŒ‡çŠ¶æ€å®¹å™¨ï¼›</li> <li>æ“ä½œæ›´æ–°çŠ¶æ€æ–¹å¼ç»Ÿä¸€ï¼Œå¹¶ä¸”å¯æ§ï¼Œé€šå¸¸ä»¥ action æ–¹å¼æä¾›æ›´æ–°çŠ¶æ€çš„é€”å¾„ï¼›</li> <li>æ”¯æŒå°† store ä¸ React ç»„ä»¶è¿æ¥ï¼Œå¦‚<code>react-redux</code>ï¼Œ<code>mobx-react</code>ï¼›é€šå¸¸ä½¿ç”¨çŠ¶æ€ç®¡ç†åº“åï¼Œæˆ‘ä»¬å°† React ç»„ä»¶ä»ä¸šåŠ¡ä¸Šåˆ’åˆ†ä¸ºä¸¤ç±»ï¼š
<ol><li>å®¹å™¨ç»„ä»¶ï¼ˆContainer Componentsï¼‰ï¼šå«æœ‰æŠ½è±¡æ•°æ®è€Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘çš„ç»„ä»¶ï¼›</li> <li>å±•ç¤ºå‹ç»„ä»¶ï¼ˆPresentation Componentsï¼‰ï¼šè´Ÿè´£å±•ç¤ºè§†å›¾ï¼Œè§†å›¾äº¤äº’å›è°ƒå†…è°ƒç”¨ä¼ å…¥çš„å¤„ç†å‡½æ•°ï¼›</li></ol></li></ol> <h2 id="redux-vs-mobx"><a href="#redux-vs-mobx" aria-hidden="true" class="header-anchor">#</a> Redux Vs Mobx</h2> <p>ç›®å‰æ¥çœ‹ï¼ŒRedux å·²æ˜¯ React åº”ç”¨çŠ¶æ€ç®¡ç†åº“ä¸­çš„éœ¸ä¸»äº†ï¼Œè€Œ Mobx åˆ™æ˜¯ä¸€æ–¹è¯¸ä¾¯ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦é€‰æ‹© Mobxï¼Œè€Œä¸æ˜¯ç»§ç»­æ²¿ç”¨ Redux å‘¢ï¼Œé‚£å°±éœ€è¦æ¯”è¾ƒä»–ä»¬çš„å¼‚åŒäº†ã€‚
Mobx å’Œ Redux éƒ½æ˜¯ JavaScript åº”ç”¨çŠ¶æ€ç®¡ç†åº“ï¼Œéƒ½é€‚ç”¨äº Reactï¼ŒAngularï¼ŒVueJs ç­‰æ¡†æ¶æˆ–åº“ï¼Œè€Œä¸æ˜¯å±€é™äºæŸä¸€ç‰¹å®š UI åº“ã€‚</p> <p>ä¸‹é¢åˆ†åˆ«ç”¨ Redux å’Œ Mobx å®ç°ä¸€ä¸ª todo listï¼Œå¯¹æ¯”ä»¥ä¸‹å„è‡ªçš„å®ç°æ–¹å¼ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// redux todo list</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> List <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

type TTodo <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> number
  title<span class="token punctuation">:</span> string
<span class="token punctuation">}</span>

type TInitState <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>TTodo<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">// åˆå§‹state</span>
<span class="token keyword">const</span> initState<span class="token punctuation">:</span> TInitState <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

type TAction <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> string
  payload<span class="token operator">?</span><span class="token punctuation">:</span> any
<span class="token punctuation">}</span>

<span class="token comment">// reducer</span>
<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initState<span class="token punctuation">,</span> action<span class="token punctuation">:</span> TAction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'init'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> todos<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">'add'</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> todos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token keyword">const</span> initTodos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">TAction</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'init'</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'webå‰ç«¯'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token punctuation">(</span>title<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">TAction</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'add'</span><span class="token punctuation">,</span>
    payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      title<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

type TProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>TTodo<span class="token operator">&gt;</span>
  dispatch<span class="token punctuation">:</span> Function
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>TProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    inputVal<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">initTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> todos<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>todolist<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Input
            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
            value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputVal<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> inputVal<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Button
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputVal<span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                inputVal<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">&gt;</span>
            Add
          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>List
          header<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>TodoList<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span>
          bordered
          dataSource<span class="token operator">=</span><span class="token punctuation">{</span>todos<span class="token punctuation">}</span>
          renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> TodoListView <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">:</span> TInitState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    todos<span class="token punctuation">:</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">ReduxApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>ReduxApp<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>TodoListView <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ReduxApp
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mobx todo list</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Input<span class="token punctuation">,</span> List <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

type TTodo <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> number
  title<span class="token punctuation">:</span> string
<span class="token punctuation">}</span>

<span class="token comment">// state</span>
<span class="token keyword">class</span> <span class="token class-name">TodoListState</span> <span class="token punctuation">{</span>
  @observable todos<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>TTodo<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  @action <span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'webå‰ç«¯'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  @action <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">todo<span class="token punctuation">:</span> TTodo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoListState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

type TProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  todos<span class="token operator">?</span><span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>TTodo<span class="token operator">&gt;</span>
  init<span class="token operator">?</span><span class="token punctuation">:</span> Function
  addTodo<span class="token operator">?</span><span class="token punctuation">:</span> Function
<span class="token punctuation">}</span>

@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">stores<span class="token punctuation">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    todos<span class="token punctuation">:</span> stores<span class="token punctuation">.</span>store<span class="token punctuation">.</span>todos<span class="token punctuation">,</span>
    init<span class="token punctuation">:</span> stores<span class="token punctuation">.</span>store<span class="token punctuation">.</span>init<span class="token punctuation">,</span>
    addTodo<span class="token punctuation">:</span> stores<span class="token punctuation">.</span>store<span class="token punctuation">.</span>addTodo<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>TProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    inputVal<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>init<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> todos<span class="token punctuation">,</span> addTodo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>todolist<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Input
            style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
            value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputVal<span class="token punctuation">}</span>
            onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> inputVal<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">/</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Button
            onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              addTodo<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                title<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>inputVal<span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                inputVal<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token operator">&gt;</span>
            Add
          <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>List
          header<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>TodoList<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span>
          bordered
          dataSource<span class="token operator">=</span><span class="token punctuation">{</span>todos<span class="token punctuation">}</span>
          renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item key<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">ReduxApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>ReduxApp<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>TodoList <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ReduxApp
</code></pre></div><h2 id="å…ˆç®€å•ä»‹ç»ä¸€ä¸‹-redux"><a href="#å…ˆç®€å•ä»‹ç»ä¸€ä¸‹-redux" aria-hidden="true" class="header-anchor">#</a> å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ Redux</h2> <p>è¦ä»‹ç» Reduxï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸è°ˆåˆ° Flux äº†</p> <p>Flux æ˜¯ Facebook ç”¨æ¥å¼€å‘å®¢æˆ·ç«¯-æœåŠ¡ç«¯ web åº”ç”¨ç¨‹åºçš„åº”ç”¨æ¶æ„ï¼Œå®ƒæ›´å¤šæ˜¯ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œè€Œéä¸€ä¸ªç‰¹å®šæ¡†æ¶ã€‚Flux çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šæ•°æ®å’Œé€»è¾‘æ°¸è¿œå•é¡¹æµåŠ¨ã€‚</p> <p><img src="/assets/img/flux2.5804ff54.png" alt="flux æ¨¡å‹"></p> <p>è€Œ Redux æ›´å¤šçš„æ˜¯éµå¾ª Flux æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œæ˜¯ä¸€ä¸ª JavaScript åº“ï¼Œå®ƒå…³æ³¨ç‚¹ä¸»è¦æ˜¯ä»¥ä¸‹å‡ æ–¹é¢ï¼š</p> <ul><li>Actionï¼šä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œæè¿°åŠ¨ä½œç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦åŒ…å« type å±æ€§å’Œ payload å±æ€§ï¼š
<ul><li>typeï¼šaction ç±»å‹ï¼›</li> <li>payloadï¼šè´Ÿè½½æ•°æ®ï¼›</li></ul></li> <li>Reducerï¼šå®šä¹‰åº”ç”¨çŠ¶æ€å¦‚ä½•å“åº”ä¸åŒåŠ¨ä½œï¼ˆactionï¼‰ï¼Œå¦‚ä½•æ›´æ–°çŠ¶æ€ï¼›</li> <li>Storeï¼šç®¡ç† action å’Œ reducer åŠå…¶å…³ç³»çš„å¯¹è±¡ï¼Œä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
<ul><li>ç»´æŠ¤åº”ç”¨çŠ¶æ€å¹¶æ”¯æŒè®¿é—®çŠ¶æ€ï¼ˆgetState()ï¼‰ï¼›</li> <li>æ”¯æŒç›‘å¬ action çš„åˆ†å‘ï¼Œæ›´æ–°çŠ¶æ€ï¼ˆdispatch(action)ï¼‰ï¼›</li> <li>æ”¯æŒè®¢é˜… store çš„å˜æ›´ï¼ˆsubscribe(listener)ï¼‰ï¼›</li></ul></li> <li>å¼‚æ­¥æµï¼šç”±äº Redux æ‰€æœ‰å¯¹ store çŠ¶æ€çš„å˜æ›´ï¼Œéƒ½åº”è¯¥é€šè¿‡ action è§¦å‘ï¼Œå¼‚æ­¥ä»»åŠ¡ï¼ˆé€šå¸¸éƒ½æ˜¯ä¸šåŠ¡æˆ–è·å–æ•°æ®ä»»åŠ¡ï¼‰ä¹Ÿä¸ä¾‹å¤–ï¼Œè€Œä¸ºäº†ä¸å°†ä¸šåŠ¡æˆ–æ•°æ®ç›¸å…³çš„ä»»åŠ¡æ··å…¥ React ç»„ä»¶ä¸­ï¼Œå°±éœ€è¦ä½¿ç”¨å…¶ä»–æ¡†æ¶é…åˆç®¡ç†å¼‚æ­¥ä»»åŠ¡æµç¨‹ï¼Œå¦‚<code>redux-thunk</code>ï¼Œ<code>redux-saga</code>ç­‰ï¼›</li></ul> <h2 id="æ¥ä¸‹æ¥å›åˆ°ä¸»é¢˜-mobx"><a href="#æ¥ä¸‹æ¥å›åˆ°ä¸»é¢˜-mobx" aria-hidden="true" class="header-anchor">#</a> æ¥ä¸‹æ¥å›åˆ°ä¸»é¢˜ -- Mobx</h2> <p>æ¥ä¸‹æ¥æˆ‘åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨æ¥è®²è§£ Mobxï¼š</p> <ul><li>Mobx æ˜¯ä»€ä¹ˆ</li> <li>Mobx æ ¸å¿ƒæ¦‚å¿µ</li> <li>åœ¨ React é‡Œä½¿ç”¨ Mobx</li></ul> <h3 id="mobx-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#mobx-æ˜¯ä»€ä¹ˆï¼Ÿ" aria-hidden="true" class="header-anchor">#</a> Mobx æ˜¯ä»€ä¹ˆï¼Ÿ</h3> <p>Mobx æ˜¯ä¸€ä¸ªé€šè¿‡å‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼Œè®©çŠ¶æ€ç®¡ç†æ›´åŠ ç®€å•å’Œå®¹æ˜“æ‹“å±•çš„çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒéµå¾ªä¸€ä¸ªç®€å•çš„åŸåˆ™ï¼š</p> <p>Anything that can be derived from the application state, should be derived. Automatically.
ä»»ä½•å¯ä»¥ä»åº”ç”¨çŠ¶æ€çš„è·å–çš„æ•°æ®ï¼Œéƒ½åº”è¯¥è‡ªåŠ¨è·å–ã€‚</p> <h3 id="mobx-æ ¸å¿ƒæ¦‚å¿µ"><a href="#mobx-æ ¸å¿ƒæ¦‚å¿µ" aria-hidden="true" class="header-anchor">#</a> Mobx æ ¸å¿ƒæ¦‚å¿µ</h3> <p><img src="/assets/img/flow.7c7e6d63.png" alt="mobx"></p> <p>æ ¸å¿ƒåŸç†ï¼šé€šè¿‡ action è§¦å‘ state çš„å˜åŒ–ï¼Œè¿›è€Œè§¦å‘ state çš„è¡ç”Ÿ(Derivations)å¯¹è±¡(computed value &amp; Reactions)ã€‚</p> <p>å¯ä»¥çœ‹å‡ºï¼ŒMobx çš„æ ¸å¿ƒæ¦‚å¿µæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p> <ul><li>State(çŠ¶æ€) å¯¹åº”ä¸šåŠ¡çš„çŠ¶æ€</li> <li>Action(åŠ¨ä½œ) æ˜¯ä»»ä¸€ä¸€æ®µå¯ä»¥æ”¹å˜çŠ¶æ€çš„ä»£ç ã€‚ç”¨æˆ·äº‹ä»¶ã€åç«¯æ•°æ®æ¨é€ã€é¢„å®šäº‹ä»¶ã€ç­‰ç­‰ã€‚åœ¨ MobX ä¸­å¯ä»¥æ˜¾å¼åœ°å®šä¹‰åŠ¨ä½œï¼Œå®ƒå¯ä»¥å¸®ä½ æŠŠä»£ç ç»„ç»‡çš„æ›´æ¸…æ™°ã€‚ å¦‚æœæ˜¯åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä½¿ç”¨ MobX çš„è¯ï¼ŒMobX ä¼šå¼ºåˆ¶åªæœ‰åœ¨åŠ¨ä½œä¹‹ä¸­æ‰å¯ä»¥ä¿®æ”¹çŠ¶æ€ã€‚</li> <li>Derivations(è¡ç”Ÿ) æºè‡ªçŠ¶æ€å¹¶ä¸”ä¸ä¼šå†æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„ç›¸äº’ä½œç”¨çš„ä¸œè¥¿å°±æ˜¯è¡ç”Ÿã€‚MobX åŒºåˆ†äº†ä¸¤ç§ç±»å‹çš„è¡ç”Ÿ:
<ul><li>Computed values(è®¡ç®—å€¼) - å®ƒä»¬æ˜¯æ°¸è¿œå¯ä»¥ä½¿ç”¨çº¯å‡½æ•°(pure function)ä»å½“å‰å¯è§‚å¯ŸçŠ¶æ€ä¸­è¡ç”Ÿå‡ºçš„å€¼ã€‚</li> <li>Reactions(ååº”) - Reactions æ˜¯å½“çŠ¶æ€æ”¹å˜æ—¶éœ€è¦è‡ªåŠ¨å‘ç”Ÿçš„å‰¯ä½œç”¨ã€‚éœ€è¦æœ‰ä¸€ä¸ªæ¡¥æ¢æ¥è¿æ¥å‘½ä»¤å¼ç¼–ç¨‹(imperative programming)å’Œå“åº”å¼ç¼–ç¨‹(reactive programming)ã€‚æˆ–è€…è¯´å¾—æ›´æ˜ç¡®ä¸€äº›ï¼Œå®ƒä»¬æœ€ç»ˆéƒ½éœ€è¦å®ç° I / O æ“ä½œã€‚</li></ul></li></ul> <h4 id="state"><a href="#state" aria-hidden="true" class="header-anchor">#</a> State</h4> <p>åœ¨ Mobx ä¸­ï¼ŒState å¯¹åº”ä¸šåŠ¡çš„çŠ¶æ€ï¼Œé€šè¿‡ observableï¼Œå¯ä»¥ä½¿è¿™äº›çŠ¶æ€å˜å¾—å¯è§‚å¯Ÿã€‚</p> <p>é€šå¸¸æ”¯æŒè¢« observable çš„ç±»å‹æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ Object, Array, Mapï¼Œå¯¹äºåŸå§‹ç±»å‹å¯ä»¥ä½¿ç”¨ <code>Obserable.box</code>ã€‚</p> <p>ä¸‹é¢æ˜¯é’ˆå¯¹ Object, Array, Map çš„ä¸€ä¸ª ğŸŒ°:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>

<span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  @observable timer <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä»¥ä¸Šä»£ç ä¹Ÿå¯ä»¥å†™ä¸ºï¼Œ</span>
<span class="token comment">// class AppState {</span>
<span class="token comment">//   timer = 0</span>
<span class="token comment">// }</span>
<span class="token comment">// decorate(AppState, {</span>
<span class="token comment">//   timer: observable,</span>
<span class="token comment">// })</span>

<span class="token keyword">const</span> appState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

type IProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  appState<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    timer<span class="token punctuation">:</span> number<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

@observer
<span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ³¨æ„äº†ï¼Œè¿™é‡Œç›´æ¥æ”¹å˜äº†propsçš„å€¼ï¼Œ</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span>timer <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> appState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Demo1<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>appState<span class="token punctuation">.</span>timer<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&lt;</span>Demo1 appState<span class="token operator">=</span><span class="token punctuation">{</span>appState<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>è¿™å¯ä»¥è¯´æ˜¯ä¸€æ®µå®Œæ•´çš„ä»£ç ï¼Œä½†è¿™ç§å†™æ³•ä¼šæœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œæ›´æ”¹ state çš„åœ°æ–¹ä¼šæ¯”è¾ƒæ•£ä¹±ï¼Œå½“é¡¹ç›®è¶Šæ¥è¶Šå¤§æ—¶ï¼Œä½ æ ¹æœ¬éš¾ä»¥å®šä½åˆ°ä¿®æ”¹ state çš„åœ°æ–¹ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç»Ÿä¸€å®šåˆ¶ä¿®æ”¹ state æ–¹å¼ã€‚</p> <h4 id="action"><a href="#action" aria-hidden="true" class="header-anchor">#</a> Action</h4> <p>åœ¨è®² State æ—¶ï¼Œæœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼Œå¦‚æœä¸è¿›è¡Œé™åˆ¶ state ä¿®æ”¹çš„æ–¹å¼ï¼Œå½“é¡¹ç›®è¶Šæ¥è¶Šå¤§æ—¶ï¼ŒçŠ¶æ€çš„å˜æ›´ä¼šå¾ˆéš¾é¢„æµ‹ï¼Œåœ¨ redux ä¸­ï¼Œå”¯ä¸€å¯ä»¥æ›´æ”¹ state çš„é€”å¾„ä¾¿æ˜¯ dispatch ä¸€ä¸ª actionã€‚è¿™ç§çº¦æŸæ€§å¸¦æ¥çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ç»´æŠ¤æ€§ã€‚æ•´ä¸ª state åªè¦æ”¹å˜å¿…å®šæ˜¯é€šè¿‡ action è§¦å‘çš„ï¼Œå¯¹æ­¤åªè¦æ‰¾åˆ° reducer ä¸­å¯¹åº”çš„ action ä¾¿èƒ½æ‰¾åˆ°å½±å“æ•°æ®æ”¹å˜çš„åŸå› ã€‚è€Œ mobx ä¸­ï¼Œä¹Ÿæä¾›äº†è¿™æ ·ä¸€ç§æ–¹å¼ã€‚</p> <p>é»˜è®¤ Mobx å¹¶ä¸å¼ºåˆ¶æ‰€æœ‰ state çš„æ”¹å˜å¿…é¡»é€šè¿‡ action æ¥æ”¹å˜ï¼Œè¿™ä¸»è¦é€‚ç”¨äºä¸€äº›è¾ƒå°çš„é¡¹ç›®ã€‚å¯¹äºè¾ƒå¤§å‹çš„ï¼Œéœ€è¦å¤šäººåˆä½œçš„é¡¹ç›®æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ Mobx æä¾›çš„ api configure æ¥å¼ºåˆ¶ï¼Œå…¶ä¸­<code>enforceActions</code>å°±æ˜¯ç”¨äºè®¾ç½®æ”¹å˜çŠ¶æ€çš„ä¸¥æ ¼æ¨¡å¼ã€‚
<code>enforceActions</code>æœ‰å¦‚ä¸‹å€¼ï¼š</p> <ul><li><code>never</code>(é»˜è®¤): å¯ä»¥åœ¨ä»»æ„åœ°æ–¹ä¿®æ”¹çŠ¶æ€</li> <li><code>observed</code>: åœ¨æŸå¤„è§‚å¯Ÿåˆ°çš„æ‰€æœ‰çŠ¶æ€éƒ½éœ€è¦é€šè¿‡åŠ¨ä½œè¿›è¡Œæ›´æ”¹ã€‚åœ¨æ­£å¼åº”ç”¨ä¸­æ¨èæ­¤ä¸¥æ ¼æ¨¡å¼ã€‚</li> <li><code>always</code>: çŠ¶æ€å§‹ç»ˆéœ€è¦é€šè¿‡åŠ¨ä½œæ¥æ›´æ–°(å®é™…ä¸Šè¿˜åŒ…æ‹¬åˆ›å»º)</li></ul> <p><code>enforceActions</code>åŸç†ï¼šé€šè¿‡æ”¹å˜å…¨å±€çš„ strictMode ä»¥åŠ allowStateChanges å±æ€§çš„æ–¹å¼æ¥å®ç°å¼ºåˆ¶ä½¿ç”¨ actionã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> configure<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token comment">// è®¾ç½®åå¦‚æœä¸é€šè¿‡actionè¿›è¡Œä¿®æ”¹å°±ä¼šæœ‰æŠ¥é”™æç¤º</span>
<span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  enforceActions<span class="token punctuation">:</span> <span class="token string">'observed'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  @observable timer <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token comment">// æ·»åŠ action</span>
  @action <span class="token function-variable function">changeTimer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">+=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> appState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

type IProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  appState<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    timer<span class="token punctuation">:</span> number
    changeTimer<span class="token punctuation">:</span> Function
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@observer
<span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span><span class="token function">changeTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> appState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Demo2<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>appState<span class="token punctuation">.</span>timer<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&lt;</span>Demo2 appState<span class="token operator">=</span><span class="token punctuation">{</span>appState<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>è®¾ç½®åªèƒ½é€šè¿‡ action æ‰èƒ½æ”¹å˜ state æ—¶ï¼Œé‚£ Mobx æ˜¯å¦‚ä½•è¿›è¡Œå¼‚æ­¥å¤„ç†å‘¢ï¼Ÿ</p> <p>å’Œ Redux ä¸åŒçš„æ˜¯ï¼ŒMobx åœ¨å¼‚æ­¥å¤„ç†ä¸Šå¹¶ä¸å¤æ‚ï¼Œä¸éœ€è¦å¼•å…¥é¢å¤–çš„ç±»ä¼¼ redux-thunkã€redux-saga è¿™æ ·çš„åº“ã€‚
å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¯¹äºå¼‚æ­¥ action é‡Œçš„å›è°ƒï¼Œè‹¥è¯¥å›è°ƒä¹Ÿè¦ä¿®æ”¹ observable çš„å€¼ï¼Œé‚£ä¹ˆè¯¥å›è°ƒä¹Ÿéœ€è¦ç»‘å®š actionã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> configure<span class="token punctuation">,</span> action<span class="token punctuation">,</span> runInAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  enforceActions<span class="token punctuation">:</span> <span class="token string">'observed'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  @observable timer <span class="token operator">=</span> <span class="token number">0</span>
  @action <span class="token function-variable function">changeTimer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token operator">?</span><span class="token punctuation">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">+=</span> num <span class="token operator">||</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  @action <span class="token function-variable function">asyncChangeTimer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token operator">?</span><span class="token punctuation">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ç›´æ¥æ”¹å˜ä¹Ÿä¼šæŠ¥é”™ï¼Œå¿…é¡»å†æ¬¡è°ƒç”¨ä¸€ä¸ªactionæ–¹æ³•æ¥æ”¹å˜</span>
      <span class="token comment">// this.timer += num || 2 // ä¼šæŠ¥é”™</span>
      <span class="token comment">// éœ€è¦è°ƒç”¨åŒæ­¥çš„actionæ–¹æ³•è¿›è¡Œæ”¹å˜stateï¼Œè¿™é‡Œæœ‰ä¸‰ç§æ–¹å¼</span>
      <span class="token comment">// 1. è°ƒç”¨å·²æœ‰action</span>
      <span class="token comment">// this.changeTimer(num)</span>
      <span class="token comment">// 2. å¯ä»¥ç›´æ¥ç”¨actionåŒ…è£¹</span>
      <span class="token comment">// action('actionAsyncChangeTimer', () =&gt; {</span>
      <span class="token comment">//   this.timer += num || 2</span>
      <span class="token comment">// })</span>
      <span class="token comment">// 3. å¦‚æœä¸æƒ³åˆ°å¤„å†™actionï¼Œå¯ä»¥ä½¿ç”¨Mobxæä¾›çš„å·¥å…·å‡½æ•°runInActionæ¥ç®€åŒ–æ“ä½œã€‚runInActionå…¶å®</span>
      <span class="token function">runInAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">+=</span> num <span class="token operator">||</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// æ³¨æ„ï¼ŒrunInAction è¿˜å¯ä»¥ç»™å®šç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºåç§°ã€‚runInAction(f) å®é™…ä¸Šæ˜¯ action(f)() çš„è¯­æ³•ç³–ã€‚</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> appState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

type IProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  appState<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    timer<span class="token punctuation">:</span> number
    changeTimer<span class="token punctuation">:</span> Function
    asyncChangeTimer<span class="token punctuation">:</span> Function
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

@observer
<span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> appState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Demo2<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>appState<span class="token punctuation">.</span>timer<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span><span class="token function">changeTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          add
        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>appState<span class="token punctuation">.</span><span class="token function">asyncChangeTimer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          <span class="token keyword">async</span> add
        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token operator">&lt;</span>Demo2 appState<span class="token operator">=</span><span class="token punctuation">{</span>appState<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>ä¸Šé¢ä»…ä»…ä»‹ç»äº†è°ƒç”¨ä¸€ä¸ªæ–°çš„æˆ–è€…ç±»ä¼¼ä¸€ä¸ªæ–°çš„ action è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œå®é™…ä¸Šå¯ä»¥ç›´æ¥ç”¨ async/await æ–¹å¼è¿›è¡Œå¤„ç†</p> <div class="language-js extra-class"><pre class="language-js"><code>@action <span class="token function-variable function">asyncChangeTimer</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token operator">?</span><span class="token punctuation">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> addNum <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeTimer</span><span class="token punctuation">(</span>addNum<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>action çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥çœ‹è¿™é‡Œï¼š<a href="https://cn.mobx.js.org/refguide/action.html" target="_blank" rel="noopener noreferrer">https://cn.mobx.js.org/refguide/action.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
action å¼‚æ­¥å¤„ç†ï¼š<a href="https://cn.mobx.js.org/best/actions.html" target="_blank" rel="noopener noreferrer">https://cn.mobx.js.org/best/actions.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="computed"><a href="#computed" aria-hidden="true" class="header-anchor">#</a> computed</h4> <p>Mobx ä¸­ state çš„è®¾è®¡åŸåˆ™å’Œ redux æœ‰ä¸€ç‚¹æ˜¯ç›¸åŒçš„ï¼Œé‚£å°±æ˜¯å°½å¯èƒ½ä¿è¯ state è¶³å¤Ÿå°ï¼Œè¶³å¤ŸåŸå­ã€‚è¿™æ ·è®¾è®¡çš„åŸåˆ™ä¸è¨€è€Œå–»ï¼Œæ— è®ºæ˜¯ç»´æŠ¤æ€§è¿˜æ˜¯æ€§èƒ½ã€‚é‚£ä¹ˆå¯¹äºä¾èµ– state çš„æ•°æ®è€Œè¡ç”Ÿå‡ºçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ computedã€‚</p> <p>ç®€è€Œè¨€ä¹‹ï¼Œä½ æœ‰ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼çš„ç»“æœä¾èµ–äº stateï¼Œå¹¶ä¸”è¯¥å€¼ä¹Ÿéœ€è¦è¢« obserableï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ computedã€‚</p> <p>é€šå¸¸åº”è¯¥å°½å¯èƒ½çš„ä½¿ç”¨è®¡ç®—å±æ€§ï¼Œå¹¶ä¸”ç”±äºå…¶å‡½æ•°å¼çš„ç‰¹ç‚¹ï¼Œå¯ä»¥æœ€å¤§åŒ–ä¼˜åŒ–æ€§èƒ½ã€‚å¦‚æœè®¡ç®—å±æ€§ä¾èµ–çš„ state æ²¡æ”¹å˜ï¼Œæˆ–è€…è¯¥è®¡ç®—å€¼æ²¡æœ‰è¢«å…¶ä»–è®¡ç®—å€¼æˆ–å“åº”ï¼ˆreactionï¼‰ä½¿ç”¨ï¼Œcomputed ä¾¿ä¸ä¼šè¿è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œcomputed å¤„äºæš‚åœçŠ¶æ€ï¼Œæ­¤æ—¶è‹¥è¯¥è®¡ç®—å±æ€§ä¸å†è¢« observableã€‚é‚£ä¹ˆå…¶ä¾¿ä¼šè¢« Mobx åƒåœ¾å›æ”¶ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> autorun<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Checkbox<span class="token punctuation">,</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">type</span> todo <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token builtin">number</span>
  title<span class="token punctuation">:</span> <span class="token builtin">string</span>
  checked<span class="token punctuation">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> TypeTodos <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>todo<span class="token operator">&gt;</span>

<span class="token keyword">class</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  @observable todos<span class="token punctuation">:</span> TypeTodos <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'haha'</span><span class="token punctuation">,</span> checked<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  @computed <span class="token keyword">get</span> <span class="token function">toDoLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> appState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'todos.length'</span><span class="token punctuation">,</span> appState<span class="token punctuation">.</span>todos<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'toDoLength'</span><span class="token punctuation">,</span> appState<span class="token punctuation">.</span>toDoLength<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
appState<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'haha-1'</span><span class="token punctuation">,</span> checked<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
appState<span class="token punctuation">.</span>todos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> <span class="token string">'haha-1-replace'</span><span class="token punctuation">,</span>
  checked<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¾“å‡ºå¦‚ä¸‹ï¼š</span>
<span class="token comment">// 'todos.length' 2</span>
<span class="token comment">// 'toDoLength' 2</span>
<span class="token comment">// 'todos.length' 2</span>
</code></pre></div><p>æœ€åä¸€è¡Œå…¶å®åªæ˜¯æ”¹äº†æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼ï¼Œä½†æ˜¯ä¹Ÿè§¦å‘äº† autorun çš„æ‰§è¡Œã€‚ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶å¦‚æœç”¨ computed ä¾¿ä¼šè§£å†³è¯¥é—®é¢˜ã€‚</p> <h4 id="autorun"><a href="#autorun" aria-hidden="true" class="header-anchor">#</a> autorun</h4> <p>å¦ä¸€ä¸ªå“åº” state çš„ api ä¾¿æ˜¯ autorunã€‚å’Œ computed ç±»ä¼¼ï¼Œæ¯å½“ä¾èµ–çš„å€¼æ”¹å˜æ—¶ï¼Œå…¶éƒ½ä¼šæ”¹å˜ã€‚ä¸åŒçš„æ˜¯ï¼Œautorun æ²¡æœ‰äº† computed çš„ä¼˜åŒ–ï¼ˆå½“ç„¶ï¼Œä¾èµ–å€¼æœªæ”¹å˜çš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šé‡æ–°è¿è¡Œï¼Œä½†ä¸ä¼šè¢«è‡ªåŠ¨å›æ”¶ï¼‰ã€‚å› æ­¤åœ¨ä½¿ç”¨åœºæ™¯æ¥è¯´ï¼Œautorun é€šå¸¸ç”¨æ¥æ‰§è¡Œä¸€äº›æœ‰å‰¯ä½œç”¨çš„ã€‚ä¾‹å¦‚æ‰“å°æ—¥å¿—ï¼Œæ›´æ–° UI ç­‰ç­‰ã€‚</p> <h4 id="reaction"><a href="#reaction" aria-hidden="true" class="header-anchor">#</a> reaction</h4> <p>Derivations ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ç»„æˆï¼š<code>computed</code> å’Œ <code>Reactions</code>ã€‚</p> <p><code>Reactions</code>è¿˜æœ‰ä¸€ä¸ª api å°±å«åš<code>reaction</code>ï¼Œä¸Šé¢çš„<code>autorun</code>æ˜¯é€šè¿‡ <code>reaction</code> å®ç°çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> observable<span class="token punctuation">,</span> autorun<span class="token punctuation">,</span> reaction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'todo1'</span><span class="token punctuation">,</span>
    done<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'todo2'</span><span class="token punctuation">,</span>
    done<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// reaction çš„é”™è¯¯ç”¨æ³•: å¯¹ length çš„å˜åŒ–ä½œå‡ºååº”, è€Œä¸æ˜¯ title çš„å˜åŒ–!</span>
<span class="token keyword">const</span> reaction1 <span class="token operator">=</span> <span class="token function">reaction</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> todos<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
  <span class="token parameter">length</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reaction 1:'</span><span class="token punctuation">,</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// reaction çš„æ­£ç¡®ç”¨æ³•: å¯¹ length å’Œ title çš„å˜åŒ–ä½œå‡ºååº”</span>
<span class="token keyword">const</span> reaction2 <span class="token operator">=</span> <span class="token function">reaction</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token parameter">titles</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reaction 2:'</span><span class="token punctuation">,</span> titles<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// autorun å¯¹å®ƒå‡½æ•°ä¸­ä½¿ç”¨çš„ä»»ä½•ä¸œè¥¿ä½œå‡ºååº”</span>
<span class="token keyword">const</span> autorun1 <span class="token operator">=</span> <span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'autorun 1:'</span><span class="token punctuation">,</span> todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>autorun1<span class="token punctuation">,</span> reaction1<span class="token punctuation">,</span> reaction2<span class="token punctuation">)</span>

todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'todo3'</span><span class="token punctuation">,</span> done<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// è¾“å‡º:</span>
<span class="token comment">// reaction 1: todo1, todo2, todo3</span>
<span class="token comment">// reaction 2: todo1, todo2, todo3</span>
<span class="token comment">// autorun 1: todo1, todo2, todo3</span>

todos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'todo1 haha'</span>
<span class="token comment">// è¾“å‡º:</span>
<span class="token comment">// reaction 2: todo1 haha, todo2, todo3</span>
<span class="token comment">// autorun 1: todo1 haha, todo2, todo3</span>
</code></pre></div><p>åœ¨ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œreaction1ã€reaction2 å’Œ autorun1 éƒ½ä¼šå¯¹ todos æ•°ç»„ä¸­çš„ todo çš„æ·»åŠ ã€åˆ é™¤æˆ–æ›¿æ¢ä½œå‡ºååº”ã€‚ ä½†åªæœ‰ reaction2 å’Œ autorun ä¼šå¯¹æŸä¸ª todo çš„ title å˜åŒ–ä½œå‡ºååº”ï¼Œå› ä¸ºåœ¨ reaction2 çš„æ•°æ®è¡¨è¾¾å¼ä¸­ä½¿ç”¨äº† titleï¼Œè€Œ reaction1 çš„æ•°æ®è¡¨è¾¾å¼æ²¡æœ‰ä½¿ç”¨ã€‚ autorun è¿½è¸ªå®Œæ•´çš„å‰¯ä½œç”¨ï¼Œå› æ­¤å®ƒå°†å§‹ç»ˆæ­£ç¡®è§¦å‘ï¼Œä½†ä¹Ÿæ›´å®¹æ˜“æ„å¤–åœ°è®¿é—®ç›¸å…³æ•°æ®</p> <p>ç²—ç•¥åœ°è®²ï¼Œreaction æ˜¯ computed(expression).observe(action(sideEffect)) æˆ– autorun(() =&gt; action(sideEffect)(expression)) çš„è¯­æ³•ç³–ã€‚</p> <h3 id="mobx-åŸç†åˆ†æ"><a href="#mobx-åŸç†åˆ†æ" aria-hidden="true" class="header-anchor">#</a> Mobx åŸç†åˆ†æ</h3> <h2 id="redux-å’Œ-mobx-çš„å¯¹æ¯”"><a href="#redux-å’Œ-mobx-çš„å¯¹æ¯”" aria-hidden="true" class="header-anchor">#</a> Redux å’Œ Mobx çš„å¯¹æ¯”</h2> <p>ä»‹ç»å®Œ Redux å’Œ Mobxï¼Œä¸‹é¢æˆ‘ä»¬è¿›è¡Œä¸€ä¸‹å¯¹æ¯”</p> <h3 id="å‡½æ•°å¼å’Œé¢å‘å¯¹è±¡"><a href="#å‡½æ•°å¼å’Œé¢å‘å¯¹è±¡" aria-hidden="true" class="header-anchor">#</a> å‡½æ•°å¼å’Œé¢å‘å¯¹è±¡</h3> <p>Redux æ›´å¤šçš„æ˜¯éµå¾ªå‡½æ•°å¼ç¼–ç¨‹ï¼ˆFunctional Programming, FPï¼‰æ€æƒ³ï¼Œè€Œ Mobx åˆ™æ›´å¤šä»é¢ç›¸å¯¹è±¡è§’åº¦è€ƒè™‘é—®é¢˜ã€‚
Redux æå€¡ç¼–å†™å‡½æ•°å¼ä»£ç ï¼Œå¦‚ reducer å°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼ˆpure functionï¼‰ï¼Œå¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>çº¯å‡½æ•°ï¼Œæ¥å—è¾“å…¥ï¼Œç„¶åè¾“å‡ºç»“æœï¼Œé™¤æ­¤ä¹‹å¤–ä¸ä¼šæœ‰ä»»ä½•å½±å“ï¼Œä¹ŸåŒ…æ‹¬ä¸ä¼šå½±å“æ¥æ”¶çš„å‚æ•°ï¼›å¯¹äºç›¸åŒçš„è¾“å…¥æ€»æ˜¯è¾“å‡ºç›¸åŒçš„ç»“æœã€‚</p> <p>Mobx è®¾è®¡æ›´å¤šåå‘äºé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰å’Œå“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰ï¼Œé€šå¸¸å°†çŠ¶æ€åŒ…è£…æˆå¯è§‚å¯Ÿå¯¹è±¡ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡çš„æ‰€æœ‰èƒ½åŠ›ï¼Œä¸€æ—¦çŠ¶æ€å¯¹è±¡å˜æ›´ï¼Œå°±èƒ½è‡ªåŠ¨è·å¾—æ›´æ–°ã€‚</p> <h3 id="å•ä¸€-store-å’Œå¤š-store"><a href="#å•ä¸€-store-å’Œå¤š-store" aria-hidden="true" class="header-anchor">#</a> å•ä¸€ store å’Œå¤š store</h3> <p>store æ˜¯åº”ç”¨ç®¡ç†æ•°æ®çš„åœ°æ–¹ï¼Œåœ¨ Redux åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯å°†æ‰€æœ‰å…±äº«çš„åº”ç”¨æ•°æ®é›†ä¸­åœ¨ä¸€ä¸ªå¤§çš„ store ä¸­ï¼Œè€Œ Mobx åˆ™é€šå¸¸æŒ‰æ¨¡å—å°†åº”ç”¨çŠ¶æ€åˆ’åˆ†ï¼Œåœ¨å¤šä¸ªç‹¬ç«‹çš„ store ä¸­ç®¡ç†ã€‚</p> <h3 id="javascript-å¯¹è±¡å’Œå¯è§‚å¯Ÿå¯¹è±¡"><a href="#javascript-å¯¹è±¡å’Œå¯è§‚å¯Ÿå¯¹è±¡" aria-hidden="true" class="header-anchor">#</a> JavaScript å¯¹è±¡å’Œå¯è§‚å¯Ÿå¯¹è±¡</h3> <p>Redux é»˜è®¤ä»¥ JavaScript åŸç”Ÿå¯¹è±¡å½¢å¼å­˜å‚¨æ•°æ®ï¼Œè€Œ Mobx ä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡ï¼š</p> <p>Redux éœ€è¦æ‰‹åŠ¨è¿½è¸ªæ‰€æœ‰çŠ¶æ€å¯¹è±¡çš„å˜æ›´ï¼›
Mobx ä¸­å¯ä»¥ç›‘å¬å¯è§‚å¯Ÿå¯¹è±¡ï¼Œå½“å…¶å˜æ›´æ—¶å°†è‡ªåŠ¨è§¦å‘ç›‘å¬ï¼›</p> <h3 id="ä¸å¯å˜ï¼ˆimmutableï¼‰å’Œå¯å˜ï¼ˆmutableï¼‰"><a href="#ä¸å¯å˜ï¼ˆimmutableï¼‰å’Œå¯å˜ï¼ˆmutableï¼‰" aria-hidden="true" class="header-anchor">#</a> ä¸å¯å˜ï¼ˆImmutableï¼‰å’Œå¯å˜ï¼ˆMutableï¼‰</h3> <p>Redux çŠ¶æ€å¯¹è±¡é€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼ˆImmutableï¼‰ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token constant">REQUEST_POST</span><span class="token punctuation">:</span>
  	<span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      post<span class="token punctuation">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>post
  	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">default</span><span class="token punctuation">:</span>
    retur nstate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ“ä½œçŠ¶æ€å¯¹è±¡ï¼Œè€Œæ€»æ˜¯åœ¨åŸæ¥çŠ¶æ€å¯¹è±¡åŸºç¡€ä¸Šè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€å¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½å¾ˆæ–¹ä¾¿çš„è¿”å›åº”ç”¨ä¸Šä¸€çŠ¶æ€ï¼›è€Œ Mobx ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨æ–°å€¼æ›´æ–°çŠ¶æ€å¯¹è±¡ã€‚</p> <h3 id="mobx-react-å’Œ-react-redux"><a href="#mobx-react-å’Œ-react-redux" aria-hidden="true" class="header-anchor">#</a> mobx-react å’Œ react-redux</h3> <p>ä½¿ç”¨ Redux å’Œ React åº”ç”¨è¿æ¥æ—¶ï¼Œéœ€è¦ä½¿ç”¨ react-redux æä¾›çš„ Provider å’Œ connectï¼š</p> <ol><li>Providerï¼šè´Ÿè´£å°† Store æ³¨å…¥ React åº”ç”¨ï¼›</li> <li>connectï¼šè´Ÿè´£å°† store state æ³¨å…¥å®¹å™¨ç»„ä»¶ï¼Œå¹¶é€‰æ‹©ç‰¹å®šçŠ¶æ€ä½œä¸ºå®¹å™¨ç»„ä»¶ props ä¼ é€’ï¼›</li></ol> <p>å¯¹äº Mobx è€Œè¨€ï¼ŒåŒæ ·éœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š</p> <ol><li>Providerï¼šä½¿ç”¨ mobx-react æä¾›çš„ Provider å°†æ‰€æœ‰ stores æ³¨å…¥åº”ç”¨ï¼›</li> <li>ä½¿ç”¨ inject å°†ç‰¹å®š store æ³¨å…¥æŸç»„ä»¶ï¼Œstore å¯ä»¥ä¼ é€’çŠ¶æ€æˆ– actionï¼›ç„¶åä½¿ç”¨ observer ä¿è¯ç»„ä»¶èƒ½å“åº” store ä¸­çš„å¯è§‚å¯Ÿå¯¹è±¡ï¼ˆobservableï¼‰å˜æ›´ï¼Œå³ store æ›´æ–°ï¼Œç»„ä»¶è§†å›¾å“åº”å¼æ›´æ–°ã€‚</li></ol> <h2 id="ç»“è¯­"><a href="#ç»“è¯­" aria-hidden="true" class="header-anchor">#</a> ç»“è¯­</h2> <p>å¦‚æœå¯¹ redux æˆ–è€… Mobx çš„åŸç†æ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä»¥ä¸‹æ–‡ç« ï¼š</p> <ul><li><a href="https://mp.weixin.qq.com/s/idWmfUbPVVqK7Yi0_9NC4A" target="_blank" rel="noopener noreferrer">å®Œå…¨ç†è§£ reduxï¼ˆä»é›¶å®ç°ä¸€ä¸ª reduxï¼‰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/a/1190000013682735" target="_blank" rel="noopener noreferrer">ç”¨æ•…äº‹è§£è¯» Mobx æºç <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æˆ‘è‡ªå·±éƒ½è¿˜æ²¡æ¥å¾—åŠçœ‹ ğŸ˜‚</li></ul> <p>æœ€ååˆ†äº«ä¸€ä¸ªå¼€æºåº“ï¼Œæˆ‘è‡ªå·±å†™çš„ redux è§£å†³æ–¹æ¡ˆåº“ï¼Œè¿˜æ²¡å†™å¤šä¹…ï¼Œä¸å¤Ÿå®Œå–„ï¼Œå¤§å®¶çœ‹äº†æ¬¢è¿ç»™æˆ‘ææå»ºè®®ï¼š<a href="https://github.com/ht1131589588/demacia" target="_blank" rel="noopener noreferrer">https://github.com/ht1131589588/demacia<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" aria-hidden="true" class="header-anchor">#</a> å‚è€ƒ</h2> <ul><li><a href="https://cn.mobx.js.org/" target="_blank" rel="noopener noreferrer">Mobx ä¸­æ–‡æ–‡æ¡£<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5a7fd72c5188257a766324ae" target="_blank" rel="noopener noreferrer">ä½ éœ€è¦ Mobx è¿˜æ˜¯ Redux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://tate-young.github.io/2019/03/20/react-mobx.html#reactions-%E5%8F%8D%E5%BA%94" target="_blank" rel="noopener noreferrer">MobX ç®€ä»‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5a3e611a6fb9a0451239279d" target="_blank" rel="noopener noreferrer">Mobx â€”â€” React çŠ¶æ€ç®¡ç†å¦ä¸€æ¡è·¯<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/14/2020, 4:51:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/front/React/Reactæºç æ¢ç´¢.html" class="prev">
        React æºç è§£è¯»
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5e1dc976.js" defer></script><script src="/assets/js/2.654fa9b9.js" defer></script><script src="/assets/js/6.c776911c.js" defer></script>
  </body>
</html>
